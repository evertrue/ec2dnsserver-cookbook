options {
  directory "<%= node['ec2dnsserver']['cache_dir'] %>";
  version "undisclosed";
  allow-transfer { "none"; };
  allow-recursion { 10/8; localnets; localhost; };
  forwarders {
    <% node['ec2dnsserver']['forwarders'].each do |forwarder| -%>
    <%= forwarder %>;
    <% end -%>
  };
  dnssec-validation <%= node['ec2dnsserver']['dnssec_validation'] -%>;
  auth-nxdomain no;
  <% unless node['ec2dnsserver']['enable-ipv6'] -%>
  listen-on-v6 { none; };
  <% end -%>
};

logging {
  channel main_log {
    syslog <%= node['ec2dnsserver']['log']['facility'] %>;
    severity <%= node['ec2dnsserver']['log']['severity'] %>;
    print-severity yes;
    print-time no;
    print-category yes;
  };
  category default {
    main_log;
  };
  <% if node['ec2dnsserver']['log']['log_queries'] -%>
  channel query_log_file {
    file "/var/log/named/query.log";
    versions 10;
    size 25m;
    print-time yes;
  };
  channel query_syslog {
    syslog <%= node['ec2dnsserver']['log']['facility'] %>;
    severity debug;
    versions 10;
    size 25m;
    print-time yes;
  };
  category queries {
    query_log_file;
    query_syslog;
  };
  <% end -%>
};
